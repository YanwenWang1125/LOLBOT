# 📊 Analysis Data Storage

This directory contains all generated game analysis data in JSON format. These files are automatically created by the LOLBOT system when analyzing LOL and Valorant matches.

## 📁 File Structure

```
analysis/
├── match_analysis_YYYYMMDD_HHMMSS.json    # LOL match analysis files
├── valorant_last_match_YYYYMMDD_HHMMSS.json  # Valorant match analysis files
└── README.md                              # This documentation
```

## 📋 File Types

### **LOL Match Analysis Files**
- **Format**: `match_analysis_YYYYMMDD_HHMMSS.json`
- **Content**: Complete LOL match analysis with Chinese commentary
- **Generated by**: `services/match_analyzer.py`
- **Triggered by**: `!lol` command or automatic game monitoring

### **Valorant Match Analysis Files**
- **Format**: `valorant_last_match_YYYYMMDD_HHMMSS.json`
- **Content**: Complete Valorant match analysis with Chinese commentary
- **Generated by**: `services/va_match_analyzer.py`
- **Triggered by**: `!va` command or automatic game monitoring

## 📊 Data Structure

### LOL Match Analysis Structure
```json
{
  "match_info": {
    "match_id": "NA1_1234567890",
    "game_creation": 1698000000000,
    "game_duration": 1800,
    "game_mode": "CLASSIC",
    "game_type": "MATCHED_GAME",
    "map_id": 11,
    "platform_id": "NA1",
    "queue_id": 420,
    "season_id": 13,
    "game_version": "13.20.1"
  },
  "player_info": {
    "summoner_name": "PlayerName",
    "summoner_level": 150,
    "champion_name": "Jinx",
    "champion_id": 222,
    "team_position": "BOTTOM",
    "individual_position": "BOTTOM"
  },
  "performance": {
    "kills": 12,
    "deaths": 3,
    "assists": 8,
    "kda": 6.67,
    "cs": 180,
    "gold_earned": 12000,
    "damage_dealt": 45000,
    "vision_score": 25
  },
  "chinese_analysis": "详细的中文分析内容...",
  "analysis_timestamp": "2025-10-21T18:30:00Z"
}
```

### Valorant Match Analysis Structure
```json
{
  "match_info": {
    "match_id": "valorant_match_id",
    "map": "Bind",
    "mode": "Competitive",
    "rounds_won": 13,
    "rounds_lost": 11,
    "score": "13-11"
  },
  "player_info": {
    "name": "PlayerName#1234",
    "tag": "1234",
    "level": 45,
    "rank": "Gold 2"
  },
  "performance": {
    "kills": 18,
    "deaths": 12,
    "assists": 5,
    "kda": 1.92,
    "headshots": 8,
    "damage": 3200,
    "first_bloods": 2
  },
  "chinese_analysis": "详细的中文分析内容...",
  "analysis_timestamp": "2025-10-21T18:30:00Z"
}
```

## 🔄 File Lifecycle

### **Creation Process**
1. **Game Detection** → System detects completed match
2. **Data Retrieval** → Fetch match data from Riot API
3. **AI Analysis** → Generate Chinese analysis using OpenAI
4. **File Generation** → Save analysis to JSON file
5. **Audio Generation** → Create TTS audio file
6. **Discord Playback** → Play audio in voice channel

### **Cleanup Process**
- **Automatic Cleanup**: Old files are automatically removed
- **Retention Policy**: Keep only the 5 most recent files
- **File Management**: Managed by `services/data_maintenance.py`
- **Storage Optimization**: Prevents disk space issues

## 📈 Data Usage

### **Analysis Content**
- **Performance Metrics**: KDA, CS, damage, vision score
- **Game Statistics**: Match duration, game mode, map
- **Player Information**: Summoner level, champion, position
- **Chinese Commentary**: AI-generated analysis in Chinese

### **Integration Points**
- **TTS Generation**: Analysis text used for audio generation
- **Discord Integration**: Content played in voice channels
- **Data Persistence**: Historical analysis storage
- **Performance Tracking**: Long-term player performance analysis

## 🔧 File Management

### **Automatic Management**
```python
# File cleanup is handled automatically
from services.utils import cleanup_old_files

# Keep only 5 most recent files
cleanup_stats = cleanup_old_files(keep_count=5)
```

### **Manual Management**
```bash
# View file statistics
!files

# Check data location
!show_data_location
```

## 📊 File Statistics

### **Storage Information**
- **File Count**: Automatically maintained (max 5 files)
- **File Size**: Typically 5-50KB per analysis
- **Retention**: 5 most recent analyses kept
- **Cleanup**: Automatic old file removal

### **Performance Metrics**
- **Generation Time**: 2-5 seconds per analysis
- **Storage Efficiency**: JSON format for optimal size
- **Access Speed**: Fast file system access
- **Backup**: Files can be backed up for historical analysis

## 🎯 Use Cases

### **Historical Analysis**
- **Performance Tracking**: Monitor player improvement over time
- **Trend Analysis**: Identify patterns in gameplay
- **Comparison**: Compare different matches and performances
- **Statistics**: Generate long-term performance reports

### **Debugging and Support**
- **Error Analysis**: Review failed analysis attempts
- **Performance**: Analyze system performance over time
- **Quality Control**: Ensure analysis quality and consistency
- **Troubleshooting**: Debug analysis generation issues

## 🔒 Data Security

### **Privacy Considerations**
- **User Data**: Contains player performance information
- **Access Control**: Files stored locally on server
- **Retention Policy**: Automatic cleanup prevents data accumulation
- **Anonymization**: No personal information beyond game data

### **Data Protection**
- **File Permissions**: Proper file system permissions
- **Backup Strategy**: Regular cleanup prevents data loss
- **Access Logging**: File access can be monitored
- **Secure Storage**: Files stored in secure server environment

## 🧪 Testing and Validation

### **File Validation**
```python
# Validate analysis file structure
import json

def validate_analysis_file(file_path):
    with open(file_path, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    required_fields = ['match_info', 'player_info', 'performance', 'chinese_analysis']
    return all(field in data for field in required_fields)
```

### **Quality Assurance**
- **Data Integrity**: Validate JSON structure
- **Content Quality**: Ensure analysis completeness
- **Performance Metrics**: Verify statistical accuracy
- **Chinese Analysis**: Check analysis language and quality

## 📚 Integration Examples

### **Reading Analysis Files**
```python
import json
from datetime import datetime

# Load analysis file
with open('analysis/match_analysis_20251021_183000.json', 'r', encoding='utf-8') as f:
    analysis = json.load(f)

# Extract key information
match_id = analysis['match_info']['match_id']
kda = analysis['performance']['kda']
chinese_analysis = analysis['chinese_analysis']
```

### **Batch Processing**
```python
import os
import json

# Process all analysis files
analysis_dir = 'analysis'
for filename in os.listdir(analysis_dir):
    if filename.endswith('.json'):
        file_path = os.path.join(analysis_dir, filename)
        with open(file_path, 'r', encoding='utf-8') as f:
            data = json.load(f)
            # Process analysis data
```

## 🔄 Maintenance

### **Regular Maintenance**
- **File Cleanup**: Automatic old file removal
- **Storage Monitoring**: Check disk space usage
- **Data Validation**: Verify file integrity
- **Performance Optimization**: Optimize file access

### **Troubleshooting**
- **File Corruption**: Check JSON validity
- **Missing Files**: Verify analysis generation
- **Permission Issues**: Check file system permissions
- **Storage Issues**: Monitor disk space

## 📈 Performance Optimization

### **Storage Optimization**
- **File Compression**: JSON files are naturally compact
- **Cleanup Strategy**: Keep only recent files
- **Access Patterns**: Optimize for sequential access
- **Memory Usage**: Efficient JSON parsing

### **I/O Optimization**
- **File Caching**: Cache frequently accessed files
- **Batch Operations**: Process multiple files efficiently
- **Async I/O**: Non-blocking file operations
- **Error Handling**: Robust file operation handling

---

*This directory contains the core analysis data generated by the LOLBOT system. All game analysis results are stored here for historical tracking and performance monitoring.*
